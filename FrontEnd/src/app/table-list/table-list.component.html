<div class="main-content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header card-header-danger">
                        <h4 class="card-title">Liste des Fonctionnaires</h4>
                        <p class="card-category">Données extraites des documents</p>
                    </div>
                    <div class="card-body">
                        <!-- Barre d'outils avec filtres et boutons -->
                        <div class="toolbar-section mb-4">
                            <div class="row align-items-center">
                                <!-- Section Filtre -->
                                <div class="col-md-6">
                                    <div class="filter-section">
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text">
                                                    <i class="material-icons">search</i>
                                                </span>
                                            </div>
                                            <input type="text" class="form-control"
                                                placeholder="Rechercher par nom, prénom ou grade..."
                                                [(ngModel)]="searchTerm" (input)="applyFilter()">
                                            <div class="input-group-append" *ngIf="searchTerm">
                                                <button class="btn btn-outline-secondary" type="button"
                                                    (click)="clearFilter()">
                                                    <i class="material-icons">clear</i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Section Boutons d'action -->
                                <div class="col-md-6">
                                    <div class="action-buttons text-right">
                                        <!-- Bouton Import -->
                                        <button class="btn btn-info btn-sm mr-2" (click)="triggerFileInput()"
                                            title="Importer des données">
                                            <i class="material-icons">cloud_upload</i>
                                            Importer
                                        </button>

                                        <!-- Input file caché -->
                                        <input #fileInput type="file" accept=".csv,.xlsx,.json" style="display: none"
                                            (change)="onFileSelected($event)">

                                        <!-- Bouton Export -->
                                        <div class="btn-group" role="group">
                                            <button type="button" class="btn btn-success btn-sm dropdown-toggle"
                                                data-toggle="dropdown" title="Exporter les données">
                                                <i class="material-icons">cloud_download</i>
                                                Exporter
                                            </button>
                                            <div class="dropdown-menu">
                                                <a class="dropdown-item" href="#" (click)="exportToCSV()">
                                                    <i class="material-icons">description</i> CSV
                                                </a>
                                                <a class="dropdown-item" href="#" (click)="exportToExcel()">
                                                    <i class="material-icons">table_chart</i> Excel
                                                </a>
                                                <a class="dropdown-item" href="#" (click)="exportToJSON()">
                                                    <i class="material-icons">code</i> JSON
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Indicateurs de résultats -->
                        <div class="results-info mb-3" *ngIf="filteredFonctionnaires.length !== fonctionnaires.length">
                            <small class="text-muted">
                                Affichage de {{ filteredFonctionnaires.length }} résultat(s) sur {{
                                fonctionnaires.length }} total
                                <span *ngIf="searchTerm" class="ml-2">
                                    pour "{{ searchTerm }}"
                                </span>
                            </small>
                        </div>

                        <!-- Tableau -->
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead class="text-primary">
                                    <tr>
                                        <th>#</th>
                                        <th class="sortable-header" (click)="sortBy('nom')">
                                            Nom
                                            <i class="material-icons sort-icon">
                                                {{ getSortIcon('nom') }}
                                            </i>
                                        </th>
                                        <th class="sortable-header" (click)="sortBy('prenom')">
                                            Prénom
                                            <i class="material-icons sort-icon">
                                                {{ getSortIcon('prenom') }}
                                            </i>
                                        </th>
                                        <th class="sortable-header" (click)="sortBy('grade')">
                                            Grade
                                            <i class="material-icons sort-icon">
                                                {{ getSortIcon('grade') }}
                                            </i>
                                        </th>
                                        <th class="sortable-header" (click)="sortBy('dateRecrutement')">
                                            Date de Recrutement
                                            <i class="material-icons sort-icon">
                                                {{ getSortIcon('dateRecrutement') }}
                                            </i>
                                        </th>
                                        <th class="text-center">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let f of filteredFonctionnaires; index as i" class="table-row">
                                        <td>{{ i + 1 }}</td>
                                        <td>{{ f.nom }}</td>
                                        <td>{{ f.prenom }}</td>
                                        <td>
                                            <span class="badge badge-info">{{ f.grade }}</span>
                                        </td>
                                        <td>{{ f.dateRecrutement | date:'dd/MM/yyyy' }}</td>
                                        <td class="text-center">
                                            <div class="action-buttons-inline">
                                                <button class="btn btn-info btn-sm action-btn"
                                                    (click)="openShowModal(f, i)" title="Voir les détails">
                                                    <i class="material-icons">visibility</i>
                                                </button>
                                                <button class="btn btn-warning btn-sm action-btn"
                                                    (click)="openEditModal(f, i)" title="Modifier">
                                                    <i class="material-icons">edit</i>
                                                </button>
                                                <button class="btn btn-danger btn-sm action-btn"
                                                    (click)="openDeleteModal(f, i)" title="Supprimer">
                                                    <i class="material-icons">delete</i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>

                            <!-- Message si aucun résultat -->
                            <div *ngIf="filteredFonctionnaires.length === 0" class="no-results text-center py-4">
                                <i class="material-icons text-muted" style="font-size: 48px;">search_off</i>
                                <p class="text-muted mt-2">
                                    <span *ngIf="searchTerm; else noData">
                                        Aucun résultat trouvé pour "{{ searchTerm }}"
                                    </span>
                                    <ng-template #noData>
                                        Aucune donnée à afficher
                                    </ng-template>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal pour afficher les détails -->
<div class="modal fade" id="showModal" tabindex="-1" role="dialog" aria-labelledby="showModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title" id="showModalLabel">
                    <i class="material-icons mr-2">person</i>
                    Détails du Fonctionnaire
                </h5>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" *ngIf="selectedFonctionnaire">
                <div class="row">
                    <div class="col-md-6">
                        <div class="info-card">
                            <div class="info-header">
                                <i class="material-icons">account_circle</i>
                                <h6>Informations Personnelles</h6>
                            </div>
                            <div class="info-content">
                                <div class="info-item">
                                    <label>Nom complet:</label>
                                    <span>{{ selectedFonctionnaire.prenom }} {{ selectedFonctionnaire.nom }}</span>
                                </div>
                                <div class="info-item">
                                    <label>Nom:</label>
                                    <span>{{ selectedFonctionnaire.nom }}</span>
                                </div>
                                <div class="info-item">
                                    <label>Prénom:</label>
                                    <span>{{ selectedFonctionnaire.prenom }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="info-card">
                            <div class="info-header">
                                <i class="material-icons">work</i>
                                <h6>Informations Professionnelles</h6>
                            </div>
                            <div class="info-content">
                                <div class="info-item">
                                    <label>Grade:</label>
                                    <span class="badge badge-info">{{ selectedFonctionnaire.grade }}</span>
                                </div>
                                <div class="info-item">
                                    <label>Date de recrutement:</label>
                                    <span>{{ selectedFonctionnaire.dateRecrutement | date:'dd/MM/yyyy' }}</span>
                                </div>
                                <div class="info-item">
                                    <label>Ancienneté:</label>
                                    <span>{{ calculateAnciennete(selectedFonctionnaire.dateRecrutement) }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">
                    <i class="material-icons mr-1">close</i>
                    Fermer
                </button>
                <button type="button" class="btn btn-warning" (click)="openEditModalFromShow()">
                    <i class="material-icons mr-1">edit</i>
                    Modifier
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal pour modifier -->
<div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header bg-warning text-dark">
                <h5 class="modal-title" id="editModalLabel">
                    <i class="material-icons mr-2">edit</i>
                    Modifier le Fonctionnaire
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form #editForm="ngForm" (ngSubmit)="saveEdit()">
                <div class="modal-body" *ngIf="selectedFonctionnaire">
                    <div class="form-group">
                        <label for="editNom">
                            <i class="material-icons">person</i>
                            Nom *
                        </label>
                        <input type="text" class="form-control" id="editNom" [(ngModel)]="editData.nom" name="nom"
                            required #nomInput="ngModel">
                        <div *ngIf="nomInput.invalid && nomInput.touched" class="text-danger">
                            Le nom est requis
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="editPrenom">
                            <i class="material-icons">person_outline</i>
                            Prénom *
                        </label>
                        <input type="text" class="form-control" id="editPrenom" [(ngModel)]="editData.prenom"
                            name="prenom" required #prenomInput="ngModel">
                        <div *ngIf="prenomInput.invalid && prenomInput.touched" class="text-danger">
                            Le prénom est requis
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="editGrade">
                            <i class="material-icons">work</i>
                            Grade *
                        </label>
                        <select class="form-control" id="editGrade" [(ngModel)]="editData.grade" name="grade" required
                            #gradeInput="ngModel">
                            <option value="">Sélectionner un grade</option>
                            <option value="Assistante RH">Assistante RH</option>
                            <option value="Technicien">Technicien</option>
                            <option value="Médecin">Médecin</option>
                            <option value="Secrétaire">Secrétaire</option>
                            <option value="Ingénieur">Ingénieur</option>
                            <option value="Comptable">Comptable</option>
                            <option value="Directeur">Directeur</option>
                            <option value="Manager">Manager</option>
                        </select>
                        <div *ngIf="gradeInput.invalid && gradeInput.touched" class="text-danger">
                            Le grade est requis
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="editDate">
                            <i class="material-icons">date_range</i>
                            Date de recrutement *
                        </label>
                        <input type="date" class="form-control" id="editDate" [(ngModel)]="editData.dateRecrutement"
                            name="dateRecrutement" required #dateInput="ngModel">
                        <div *ngIf="dateInput.invalid && dateInput.touched" class="text-danger">
                            La date de recrutement est requise
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">
                        <i class="material-icons mr-1">cancel</i>
                        Annuler
                    </button>
                    <button type="submit" class="btn btn-warning" [disabled]="editForm.invalid">
                        <i class="material-icons mr-1">save</i>
                        Sauvegarder
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal pour confirmer la suppression -->
<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteModalLabel">
                    <i class="material-icons mr-2">warning</i>
                    Confirmer la suppression
                </h5>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body text-center" *ngIf="selectedFonctionnaire">
                <div class="delete-icon mb-3">
                    <i class="material-icons text-danger" style="font-size: 64px;">delete_forever</i>
                </div>
                <h5>Êtes-vous sûr de vouloir supprimer ce fonctionnaire ?</h5>
                <div class="user-info mt-3 p-3 bg-light rounded">
                    <strong>{{ selectedFonctionnaire.prenom }} {{ selectedFonctionnaire.nom }}</strong><br>
                    <span class="text-muted">{{ selectedFonctionnaire.grade }}</span><br>
                    <small class="text-muted">Recruté le {{ selectedFonctionnaire.dateRecrutement | date:'dd/MM/yyyy'
                        }}</small>
                </div>
                <div class="alert alert-warning mt-3">
                    <i class="material-icons mr-2">info</i>
                    Cette action est irréversible !
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">
                    <i class="material-icons mr-1">cancel</i>
                    Annuler
                </button>
                <button type="button" class="btn btn-danger" (click)="confirmDelete()">
                    <i class="material-icons mr-1">delete</i>
                    Supprimer définitivement
                </button>
            </div>
        </div>
    </div>
</div>